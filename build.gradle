// Apply versioner first so we set the version number correctly
// in case another plugin doesn't wait until the project is evaluated before execution.
apply plugin: 'com.sarhanm.versioner'

apply plugin: 'groovy'
apply plugin: 'eclipse'
apply plugin: 'maven'

group = 'com.sarhanm'

repositories {
    jcenter()
}

dependencies {
    compile gradleApi()
    compile localGroovy()
    compile 'org.yaml:snakeyaml:1.14'
}

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:0.5'
    }
}
apply plugin: 'com.jfrog.bintray'

task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
}

artifacts {
    archives sourcesJar
}

bintray {
    user = 'sarhanm'
    key = System.env.BINTRAYTOKEN
    publications = ['archives']
    dryRun = false
    publish = true
    pkg {
        repo = 'maven'
        name = 'gradle-versioner'
        desc = 'A gradle plugin to set the project version based on git metadata'
        websiteUrl = 'https://github.com/sarhanm/gradle-versioner'
        issueTrackerUrl = 'https://github.com/sarhanm/gradle-versioner/issues'
        vcsUrl = 'https://github.com/sarhanm/gradle-versioner.git'
        licenses = ['MIT']
        labels = ['gradle', 'git', 'versioning', 'auto version']
        publicDownloadNumbers = true
        version {
            name = project.version
            attributes = ['gradle-plugin': ['com.sarhanm.versioner:com.sarhanm:gradle-versioner','com.sarhanm.version-resolver:com.sarhanm:gradle-versioner'] ]
        }
    }
}
